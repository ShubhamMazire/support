(()=>{"use strict";var e="",t="",a="",n=[],i=0;if(Dropzone.autoDiscover=!1,$("#addAttachmentDropzone").length)new Dropzone("#addAttachmentDropzone",{thumbnailWidth:125,acceptedFiles:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt,.ppt,.pptx,.sql,.json",timeout:5e4,autoProcessQueue:!1,parallelUploads:50,addRemoveLinks:!0,dictRemoveFile:'<i class="fa fa-trash-o text-danger" title="Remove"></i>',uploadMultiple:!0,init:function(){e=this;var t=document.querySelector("#save-file"),n=document.querySelector("#cancel-upload-file");function i(e,t,a){var n=e.name.split(".").pop();["pdf"].includes(n)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/pdf_icon.png"):["doc","docx"].includes(n)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/doc_icon.png"):["xls","xlsx","csv"].includes(n)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/xls_icon.png"):["text","txt"].includes(n)&&$(e.previewElement).find(".dz-image img").attr("src","/assets/img/txt_icon.png"),$(".dz-image").last().find("img").attr({width:"100%",height:"100%"})}t.addEventListener("click",(function(){$("#addAttachment").modal("toggle")})),n.addEventListener("click",(function(){e.removeAllFiles(!0),$("#attachment-counter").html(e.files.length),$("#addAttachment").modal("toggle")})),this.on("addedfile",(function(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t.size>10485760)return this.removeFile(t),displayToastr(Lang.get("messages.error_message.error"),"error",Lang.get("messages.validation.file_size")),!1;$("#attachment-counter").html(e.files.length),$(".dz-progress").hide(),$(".dz-remove").html(""),$(".dz-remove").addClass("fas fa-trash text-danger mt-3"),$(".dz-remove").prop("title","Delete"),i(t,a,n)})),this.on("sending",(function(e,t,n){var i=$(a).serializeArray();$.each(i,(function(e,t){n.append(t.name,t.value)}))}))},complete:function(e){this.getQueuedFiles().length>0&&this.processQueue()},removedfile:function(e){var t,a=parseInt($("#attachment-counter").html());if(a>0)return $("#attachment-counter").html(a-1),null!=(t=e.previewElement)?t.parentNode.removeChild(e.previewElement):void 0},success:function(e,t){var a=t.data;$("#addAttachment").modal("hide"),i=0,window.location.replace(a.redirectUrl)},error:function(t,a,n){if(e.removeAllFiles(!0),$("#attachment-counter").html(e.files.length),processingBtn("#addTicketForm","#btnSave"),null!=a.message){if(2==i)return;displayToastr(Lang.get("messages.error_message.error"),"error",a.message),i=2,setTimeout((function(){i=0}),1e3)}else{if(i)return;null==n&&this.removeFile(t),displayToastr(Lang.get("messages.error_message.error"),"error",a),i=1}}});if($("#editAttachmentDropzone").length)new Dropzone("#editAttachmentDropzone",{thumbnailWidth:125,acceptedFiles:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt,.ppt,.pptx,.sql,.json",addRemoveLinks:!0,dictRemoveFile:'<i class="fa fa-trash-o text-danger" title="Remove"></i>',timeout:5e4,autoProcessQueue:!1,parallelUploads:50,uploadMultiple:!0,init:function(){t=this;var e=document.querySelector("#save-file"),i=document.querySelector("#cancel-upload-file");function o(){$.get(getAttachmentUrl,(function(e){$.each(e.data,(function(e,a){$("#attachment-counter").html(parseInt($("#attachment-counter").html())+1);var n={name:a.name,id:a.id};t.options.addedfile.call(t,n,n.id),t.options.thumbnail.call(t,n,a.url),t.emit("complete",n),t.emit("thumbnail",n,a.url,n.id),$(".dz-remove").eq(e).attr("data-file-id",a.id),$(".dz-remove").eq(e).attr("data-file-url",a.url),$(".dz-remove").html(""),$(".dz-progress").hide(),$(".dz-remove").addClass("fas fa-trash text-danger mt-3"),$(".dz-remove").prop("title","Delete")}))}))}function s(e,t,a){var n=e.name.split(".").pop();if(["pdf"].includes(n)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/pdf_icon.png"):["doc","docx"].includes(n)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/doc_icon.png"):["xls","xlsx","csv"].includes(n)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/xls_icon.png"):["text","txt"].includes(n)&&$(e.previewElement).find(".dz-image img").attr("src","/assets/img/txt_icon.png"),"undefined"===$(e.previewElement).find(".download-link").attr("href")&&$(e.previewElement).find(".download-link").hide(),$(e.previewElement).find(".download-link").length<1&&null!=a){var i=document.createElement("a");i.setAttribute("href",ticketIndexUrl+"/media/"+a),i.setAttribute("class","download-link"),i.innerHTML="<br>Download",e.previewElement.appendChild(i)}$(".dz-image").last().find("img").attr({width:"100%",height:"100%"})}e.addEventListener("click",(function(){$("#editAttachment").modal("toggle")})),i.addEventListener("click",(function(){t.removeAllFiles(!0),$("#attachment-counter").html(0),n=[],$("div.dz-preview").remove(),o(),$("#editAttachment").modal("toggle")})),o(),this.on("thumbnail",(function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;$(e.previewTemplate).find(".dz-details").css("display","none"),s(e,t,a);var n=e.name.split("."),i=n[0].replace(/\s/g,"").replace(/\(/g,"_").replace(/\)/g,""),o=e.name.split(".").pop(),r="",l=!0;$(e.previewElement).find(".download-link").on("click",(function(){l=!1})),$.inArray(o,["jpg","JPG","jpeg","png","PNG"])>-1&&(r='<a class="'+i+'" data-fancybox="gallery" href="'+t+'" data-toggle="lightbox" data-gallery="example-gallery"></a>',$(".previewEle").append(r)),e.previewElement.addEventListener("click",(function(){if(l){var a=e.previewElement.querySelector("[data-dz-name]").innerHTML,n=a.split(".").pop();if($.inArray(n,["jpg","JPG","jpeg","png","PNG"])>-1){var i=a.split(".")[0];$(document.getElementsByClassName(i)).trigger("click")}else window.open(t,"_blank")}l=!0}))})),this.on("addedfile",(function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if($(e.previewTemplate).find(".dz-remove").attr("data-file-id","00"),e.size>10485760)return this.removeFile(e),displayToastr(Lang.get("messages.error_message.error"),"error",Lang.get("messages.validation.file_size")),!1;$("#attachment-counter").html(parseInt($("#attachment-counter").html())+1),$(".dz-progress").hide(),$(".dz-remove").html(""),$(".dz-remove").addClass("fas fa-trash text-danger mt-3"),$(".dz-remove").prop("title","Delete"),s(e,t,a)})),this.on("sending",(function(e,t,n){var i=$(a).serializeArray();$.each(i,(function(e,t){t.name.startsWith("_")||n.append(t.name,t.value)}))}))},complete:function(e){this.getQueuedFiles().length>0&&this.processQueue()},processing:function(){$(".dz-remove").html(""),$(".dz-remove").addClass("fas fa-trash mt-3 text-danger"),$(".dz-remove").prop("title","Delete"),$(".dz-details").hide()},removedfile:function(e){var t,a=e.previewElement.querySelector("[data-file-id]").getAttribute("data-file-id");return"00"!=a?(function(e,t){swal({title:Lang.get("messages.swal_message.delete"),text:Lang.get("messages.swal_message.sure_file_delete"),type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#5cb85c",cancelButtonColor:"#d33",cancelButtonText:Lang.get("messages.common.no"),confirmButtonText:Lang.get("messages.common.yes")},(function(){var a;return n.push(parseInt(t)),o("#editAttachmentDropzone"),swal({title:Lang.get("messages.swal_message.delete"),text:Lang.get("messages.swal_message.file_delete"),type:"success",confirmButtonColor:"#6777ef",confirmButtonText:Lang.get("messages.common.ok"),timer:1e3}),null!=(a=e.previewElement)?a.parentNode.removeChild(e.previewElement):void 0}))}(e,a),$("#attachment-counter").html(parseInt($("#attachment-counter").html())-1),!0):($("#attachment-counter").html(parseInt($("#attachment-counter").html())-1),null!=(t=e.previewElement)?t.parentNode.removeChild(e.previewElement):void 0)},success:function(e,t){var a=t.data;$("#editAttachment").modal("hide"),window.location.replace(a.redirectUrl)},error:function(e,a,n){if(t.removeAllFiles(!0),$("#attachment-counter").html(0),processingBtn("#editTicketForm","#btnSave"),null==a.message)return null==n&&this.removeFile(e),o("#editAttachmentDropzone"),displayToastr(Lang.get("messages.error_message.error"),"error",a),!1;displayToastr(Lang.get("messages.error_message.error"),"error",a.message),o("#editAttachmentDropzone")}});function o(e){$(".dz-preview").length>=1?$(e).find(".dz-message").css({display:"none"}):$(e).find(".dz-message").css({display:"block"})}if($(document).ready((function(){$(document).on("click","#attachmentButton",(function(){$("#addAttachment").appendTo("body").modal("show")})),$(document).on("click","#editAttachmentButton",(function(){$("#editAttachment").appendTo("body").modal("show")})),$("#categoryId").select2({width:"calc(100% - 44px)"}),$("#customer").select2({width:"calc(100% - 44px)"}),$("#customerId, #webCategoryId").select2({width:"100%"}),$("#assignedTo").select2({width:"100%",placeholder:Lang.get("messages.ticket.select_agents")}),$("#details, #Editdetails").summernote({placeholder:Lang.get("messages.ticket.add_ticket_description"),height:"200px",toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]],disableResizeEditor:!0}),$(document).on("submit","#addTicketForm",(function(t){t.preventDefault(),a="#addTicketForm";var n=$("#btnSave");n.button("loading");var i=$("<div />").html($("#details").summernote("code")),o=isOnlyContainWhiteSpace(i.text()),s=$("#email").val(),r=new RegExp(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i);return""!=s&&!s.match(r)?(displayErrorMessage(Lang.get("messages.validation.email_valid")),n.button("reset"),!1):$("#details").summernote("isEmpty")?($("#details").val(""),displayErrorMessage(Lang.get("messages.common.description")+" "+Lang.get("messages.validation.required_field")),n.button("reset"),!1):o?(displayErrorMessage(Lang.get("messages.common.description")+" "+Lang.get("messages.validation.white_space")),n.button("reset"),!1):(0==$(".dz-preview").length?$("#addTicketForm")[0].submit():e.processQueue(),!0)})),$(document).on("submit","#webTicketForm",(function(t){t.preventDefault(),a="#webTicketForm";var n=$("<div />").html($("#details").summernote("code")),i=isOnlyContainWhiteSpace(n.text());return $("#details").summernote("isEmpty")?($("#details").val(""),displayErrorMessage(Lang.get("messages.common.description")+" "+Lang.get("messages.validation.required_field")),!1):i?(displayErrorMessage(Lang.get("messages.common.description")+" "+Lang.get("messages.validation.white_space")),!1):$("#user-name").length>0&&isOnlyContainWhiteSpace($("#user-name").val())?(displayErrorMessage(Lang.get("messages.common.name")+" "+Lang.get("messages.validation.white_space")),!1):isOnlyContainWhiteSpace($("#ticket-title").val())?(displayErrorMessage(Lang.get("messages.ticket.ticket_title")+" "+Lang.get("messages.validation.white_space")),!1):(0==$(".dz-preview").length?$("#webTicketForm")[0].submit():e.processQueue(),!0)})),$(document).on("submit","#editTicketForm",(function(e){e.preventDefault(),$("input:hidden[name=deletedMediaId]").val(n),a="#editTicketForm";var i=$("#btnSave");i.button("loading");var o=$("<div />").html($("#details").summernote("code")),s=isOnlyContainWhiteSpace(o.text()),r=$("#editEmail").val(),l=new RegExp(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i);return""!=r&&!r.match(l)?(displayErrorMessage(Lang.get("messages.validation.email_valid")),i.button("reset"),!1):$("#details").summernote("isEmpty")?($("#details").val(""),displayErrorMessage(Lang.get("messages.common.description")+" "+Lang.get("messages.validation.required_field")),i.button("reset"),!1):s?(displayErrorMessage(Lang.get("messages.common.description")+" "+Lang.get("messages.validation.white_space")),i.button("reset"),!1):(0==$(".dz-preview").length||0==t.getQueuedFiles().length?$("#editTicketForm")[0].submit():t.processQueue(),!0)}))})),$(document).on("click",".addCategoryModal",(function(){$("#addModal").appendTo("body").modal("show")})),$(document).on("submit","#addNewForm",(function(e){if(""==$("#color").val())return displayErrorMessage(Lang.get("messages.validation.color_required")),!1;e.preventDefault(),processingBtn("#addNewForm","#btnSave","loading"),$.ajax({url:route("category.store"),type:"POST",data:$(this).serialize(),success:function(e){if(e.success){displaySuccessMessage(e.message),$("#addModal").modal("hide");var t={id:e.data.id,text:e.data.name},a=new Option(t.text,t.id,!1,!0);$("#categoryId").append(a).trigger("change")}},error:function(e){displayErrorMessage(e.responseJSON.message)},complete:function(){processingBtn("#addNewForm","#btnSave")}})})),$("#color").length>0){$("#addModal").on("hidden.bs.modal",(function(){resetModalForm("#addNewForm","#validationErrorsBox"),s.setColor("#33b0b0"),s.hide(),$("#colorError").text("")}));var s=Pickr.create({el:".color-wrapper",theme:"nano",closeWithKey:"Enter",autoReposition:!0,defaultRepresentation:"HEX",position:"bottom-end",default:"#33b0b0",swatches:["rgba(244, 67, 54, 1)","rgba(233, 30, 99, 1)","rgba(156, 39, 176, 1)","rgba(103, 58, 183, 1)","rgba(63, 81, 181, 1)","rgba(33, 150, 243, 1)","rgba(3, 169, 244, 1)","rgba(0, 188, 212, 1)","rgba(0, 150, 136, 1)","rgba(76, 175, 80, 1)","rgba(139, 195, 74, 1)","rgba(205, 220, 57, 1)","rgba(255, 235, 59, 1)","rgba(255, 193, 7, 1)"],components:{preview:!0,hue:!0,interaction:{input:!0,clear:!1,save:!1}}});s.on("change",(function(){var e=s.getColor().toHEXA().toString();if(function(e){var t=e.replace("#","");return(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>240}(e))return $("#validationErrorsBox").html("Pick a different color").show(),$(':input[id="btnSave"]').prop("disabled",!0),void setTimeout((function(){$(".alert").slideUp(300)}),3e3);$("#validationErrorsBox").hide(),$(':input[id="btnSave"]').prop("disabled",!1),s.setColor(e),$("#color").val(e)})),s.on("init",(function(e){var t=s.getColor().toHEXA().toString();s.setColor(t),$("#color").val(t)}));$(document).on("click","#color",(function(){!0})),$(document).keydown((function(e){27===e.keyCode&&$("#addModal").modal("hide")}))}$(document).on("click",".addCustomerModal",(function(){$("#createCustomerModal").appendTo("body").modal("show")})),$(document).on("submit","#createCustomer",(function(e){e.preventDefault(),processingBtn("#createCustomer","#btnSave","loading"),$.ajax({url:route("user.store"),type:"POST",data:$(this).serialize(),success:function(e){if(e.success){displaySuccessMessage(e.message),$("#createCustomerModal").modal("hide");var t={id:e.data.id,text:e.data.name},a=new Option(t.text,t.id,!1,!0);$("#customer").append(a).trigger("change")}},error:function(e){displayErrorMessage(e.responseJSON.message)},complete:function(){processingBtn("#createCustomer","#btnSave")}})})),$("#createCustomerModal").on("hidden.bs.modal",(function(){resetModalForm("#createCustomer","#validationErrorsBox")})),$(document).on("click","#registrationUser",(function(){$("#loginBlock").removeClass("show")})),$(document).on("click","#loginUser",(function(){$("#registrationBlock").removeClass("show")}))})();