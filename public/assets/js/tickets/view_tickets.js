(()=>{"use strict";Dropzone.autoDiscover=!1;var e="",t="",n="",s="#addRelyForm",a=$("#addTicketReply"),o=window.getComputedStyle(document.documentElement).getPropertyValue("--primary");if($("#addAttachmentDropzone").length)new Dropzone("#addAttachmentDropzone",{autoProcessQueue:!1,thumbnailWidth:125,acceptedFiles:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt,.ppt,.pptx,.sql,.json",timeout:5e4,parallelUploads:10,addRemoveLinks:!0,dictRemoveFile:'<i class="fa fa-trash-o text-danger" title="Remove"></i>',uploadMultiple:!0,init:function(){e=this;var t=document.querySelector("#save-file"),n=document.querySelector("#cancel-upload-file");function a(e,t,n){var s=e.name.split(".").pop();["pdf"].includes(s)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/pdf_icon.png"):["doc","docx"].includes(s)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/doc_icon.png"):["xls","xlsx","csv"].includes(s)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/xls_icon.png"):["text","txt"].includes(s)&&$(e.previewElement).find(".dz-image img").attr("src","/assets/img/txt_icon.png"),$(".dz-image").last().find("img").attr({width:"100%",height:"100%"})}t.addEventListener("click",(function(){$("#addAttachment").modal("toggle")})),n.addEventListener("click",(function(){e.removeAllFiles(!0),$("#addAttachment").modal("toggle")})),this.on("addedfile",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e.size>10485760)return this.removeFile(e),displayToastr(Lang.get("messages.error_message.error"),"error",Lang.get("messages.validation.file_size")),!1;$(".dz-progress").hide(),$(".dz-remove").html(""),$(".dz-remove").addClass("fas fa-trash text-danger mt-3"),$(".dz-remove").prop("title","Delete"),a(e,t,n)})),this.on("sending",(function(e,t,n){var a=$(s).serializeArray();$.each(a,(function(e,t){n.append(t.name,t.value)}))}))},complete:function(e){this.getQueuedFiles().length>0&&this.processQueue()},successmultiple:function(e,t){$("#addAttachment").modal("hide"),a.button("reset"),c(t),$("#ticketAddReplay").slideToggle()},error:function(t,n,s){e.removeAllFiles(!0),processingBtn("#addRelyForm","#addTicketReply"),null==s&&this.removeFile(t),this.processQueue=!1,null!=n.message?displayToastr(Lang.get("messages.error_message.error"),"error",n.message):displayToastr(Lang.get("messages.error_message.error"),"error",n)}});if($("#editAttachmentDropzone").length)new Dropzone("#editAttachmentDropzone",{autoProcessQueue:!1,thumbnailWidth:125,acceptedFiles:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt,.ppt,.pptx,.sql,.json",timeout:5e4,parallelUploads:10,addRemoveLinks:!0,dictRemoveFile:'<i class="fa fa-trash-o text-danger" title="Remove"></i>',uploadMultiple:!0,init:function(){t=this;var e=document.querySelector("#edit-save-file"),s=document.querySelector("#edit-cancel-upload-file");function a(e,t,n){var s=e.name.split(".").pop();["pdf"].includes(s)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/pdf_icon.png"):["doc","docx"].includes(s)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/doc_icon.png"):["xls","xlsx","csv"].includes(s)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/xls_icon.png"):["text","txt"].includes(s)&&$(e.previewElement).find(".dz-image img").attr("src","/assets/img/txt_icon.png"),$(".dz-image").last().find("img").attr({width:"100%",height:"100%"})}e.addEventListener("click",(function(){$("#editAttachment").modal("toggle")})),s.addEventListener("click",(function(){t.removeAllFiles(!0),$("#editAttachment").modal("toggle")})),this.on("addedfile",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;$(".dz-progress").hide(),$(".dz-remove").html(""),$(".dz-remove").addClass("fas fa-trash text-danger mt-3"),$(".dz-remove").prop("title","Delete"),a(e,t,n)})),this.on("sending",(function(e,t,s){s.append("description",n),s.append("ticket_id",ticketId)}))},complete:function(e){this.getQueuedFiles().length>0&&this.processQueue()},successmultiple:function(e,n){if(t.removeAllFiles(!0),$("#editAttachment").modal("hide"),$("#editTicketReply").button("reset"),0==$("#"+i+"-attachment-div").length){var s='<div class="reply-attached-files" id="'+i+'-attachment-div"><label class="ml-3 text-muted">Attachments:</label></div>';$("."+i+"-attachment-main-div").append(s)}$.each(n.data,(function(e,t){var n='<div class="ml-3 mb-1"><a target="_blank" href="'+t.url+'" class="text-muted">'+t.file_name+'</a><a href="javascript:void(0)" class="remove-attached-file text-muted ml-1" data-media-id="'+t.id+'"><i class="far fa-times-circle"></i></a></div>';$("#"+i+"-attachment-div").append(n)})),d()},error:function(e,t,n){null==n&&this.removeFile(e),this.processQueue=!1,null!=t.message?displayToastr(Lang.get("messages.error_message.error"),"error",t.message):displayToastr(Lang.get("messages.error_message.error"),"error",t)}});$(document).ready((function(){$(document).on("click","#attachmentButton",(function(){$("#addAttachment").appendTo("body").modal("show")})),$(document).on("click","#editAttachmentBtn",(function(){$("#editAttachment").appendTo("body").modal("show")})),$(document).on("mouseenter",".ticket-attachment",(function(){$(this).find(".ticket-attachment__icon").removeClass("d-none")})),$(document).on("mouseleave",".ticket-attachment",(function(){$(this).find(".ticket-attachment__icon").addClass("d-none")}))})),$(document).on("click",".delete-replay",(function(e){var t=$(e.currentTarget).data("id"),n=deleteTicketReplyUrl+t;deleteItem(n,"Replay",".activities",".activity","#notfoundReplay")})),$(document).on("click","#btnPostReplay",(function(e){$("#ticketAddReplay").slideToggle()})),$(document).on("click","#btnCancelReplay",(function(t){$("#addReplyContainer").summernote("reset"),e.removeAllFiles(!0),$("#ticketAddReplay").slideToggle()}));var i,r=$("#addReplyContainer").summernote({placeholder:Lang.get("messages.placeholder.add_ticket_reply"),height:"200px",toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]],disableResizeEditor:!0}),l=$(".editReplyContainer").summernote({height:"200px",toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]],disableResizeEditor:!0});function c(t){e.removeAllFiles(!0),r.summernote("code",""),$(".ticket-reply-box").prepend(t.data.html),$("#editReply-"+t.data.id).summernote({height:"200px",toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]],disableResizeEditor:!0})}function d(){var e=moment().fromNow();l.summernote("code",""),$(".description-"+i).html(n),$(".replyTime-"+i).html(e),$(".description-"+i).removeClass("d-none"),$("#editTicketReply-"+i).addClass("d-none")}$(document).on("submit",s,(function(t){t.preventDefault();r.summernote("code");var n,s=$("<div />").html(r.summernote("code")),o=isOnlyContainWhiteSpace(s.text());return r.summernote("isEmpty")?(displayErrorMessage(Lang.get("messages.validation.ticket_reply_required")),$("#addReplyContainer").val(""),!1):o?(displayErrorMessage(Lang.get("messages.validation.ticket_reply_white_space")),!1):(a.button("loading"),0!=$(".dz-preview").length?(e.processQueue(),!0):(n=$(this).serialize(),void $.ajax({url:addReplyUrl,type:"post",data:n,success:function(e){e.success&&c(e),a.button("reset"),$("#ticketAddReplay").slideToggle()},error:function(e){a.button("reset"),printErrorMessage("#taskValidationErrorsBox",e)}})))})),$(document).on("click","#editTicketReply",(function(e){n=$("#editReply-"+i).summernote("code");var s=$("<div />").html($("#editReply-"+i).summernote("code")),a=isOnlyContainWhiteSpace(s.text());if($("#editReply-"+i).summernote("isEmpty"))return $("#editReplyContainer").val(""),!1;if(a)return displayErrorMessage(Lang.get("messages.validation.ticket_reply_white_space")),!1;var o=$(this);if(o.button("loading"),0!=$(".dz-preview").length)return t.processQueue(),!0;$.ajax({url:baseUrl+"reply-update/"+i,type:"put",data:{description:n,ticket_id:ticketId},success:function(e){e.success&&d(),o.button("reset")},error:function(e){o.button("reset"),printErrorMessage("#taskValidationErrorsBox",e)}})})),$(document).on("click",".del-reply",(function(e){var t=$(this).data("id");swal({title:Lang.get("messages.swal_message.delete"),text:Lang.get("messages.swal_message.reply_are_you_sure"),type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:o,cancelButtonColor:"#d33",cancelButtonText:Lang.get("messages.common.no"),confirmButtonText:Lang.get("messages.common.yes")},(function(){$.ajax({url:deleteTicketReplyUrl+t,type:"DELETE",data:{ticket_id:t},success:function(e){e.success&&($(".ticket-reply-box").find("[data-remove-id='".concat(t,"']")).remove(),swal({title:Lang.get("messages.swal_message.delete"),text:Lang.get("messages.swal_message.reply_delete"),type:"success",confirmButtonColor:o,confirmButtonText:Lang.get("messages.common.ok"),timer:2e3}))},error:function(e){swal({title:"",text:e.responseJSON.message,type:"error",confirmButtonColor:o,timer:5e3})}})}))}));$(document).on("click",".edit-reply",(function(){i=$(this).data("id"),$("#editAttachmentReplyId").val(i);var e=$.trim($(".description-"+i).html());$(".editReplyBox").addClass("d-none"),$(".reply-description").removeClass("d-none"),$(".description-"+i).addClass("d-none"),$("#editTicketReply-"+i).toggleClass("d-none "),$("#editReply-"+i).summernote("code",""),$("#editReply-"+i).summernote("code",e)})),$(document).on("click",".cancelEditReply",(function(){i=$(this).data("id"),$(".description-"+i).removeClass("d-none"),$("#editTicketReply-"+i).addClass("d-none")})),$(document).on("click",".change-status",(function(e){$(this).attr("data-id");var t=$(this).attr("data-status");swal({title:Lang.get("messages.common.attention")+" !",text:Lang.get("messages.ticket.sure_for_change_status")+" ?",type:"info",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:o,cancelButtonColor:"#d33",cancelButtonText:noMessages,confirmButtonText:yesMessages},(function(){$.ajax({url:updateTicketUrl,type:"put",data:{ticket:updateTicketUrl,ticket_status:t},success:function(e){e.success&&(swal({title:Lang.get("messages.swal_message.updated"),text:Lang.get("messages.swal_message.status_changed"),type:"success",confirmButtonText:Lang.get("messages.common.ok"),timer:2e3}),location.reload())},error:function(e){swal({title:"",text:e.responseJSON.message,type:"error",confirmButtonText:Lang.get("messages.common.ok"),timer:5e3})}})}))})),$(document).on("click",".remove-attached-file",(function(e){e.preventDefault();var t=$(this).attr("data-media-id"),n=$(this).parent("div"),s=$(this).parent("div").parent();swal({title:Lang.get("messages.common.delete")+" !",text:Lang.get("messages.common.are_you_sure_delete")+' "'+Lang.get("messages.ticket.attachment")+'" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:o,cancelButtonColor:"#d33",cancelButtonText:Lang.get("messages.common.no"),confirmButtonText:Lang.get("messages.common.yes")},(function(){!function(e,t,n){$.ajax({url:route("ticket.replay.attachment.delete",e),type:"DELETE",dataType:"json",success:function(e){e.success&&(t.remove(),0==$(".reply-attached-files").find(".remove-attached-file").length&&n.remove()),swal({title:Lang.get("messages.common.delete")+" !",text:Lang.get("messages.ticket.attachment")+" "+Lang.get("messages.common.has_been_deleted")+".",type:"success",confirmButtonColor:o,confirmButtonText:Lang.get("messages.common.ok"),timer:2e3})},error:function(e){swal({title:"",text:e.responseJSON.message,type:"error",confirmButtonColor:o,timer:5e3})}})}(t,n,s)}))})),$(document).on("click",".unassigned-btn",(function(e){var t=$(this).attr("data-id");swal({title:Lang.get("messages.common.attention")+" !",text:Lang.get("messages.ticket.unassigned_warning")+" ?",type:"info",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#00b074",cancelButtonColor:"#d33",cancelButtonText:noMessages,confirmButtonText:yesMessages},(function(){$.ajax({type:"POST",url:route("ticket.unassigned"),data:{id:t},success:function(e){e.success&&(swal({title:Lang.get("messages.ticket.unassigned_ticket")+" !",text:e.message,type:"success",confirmButtonColor:"#00b074",confirmButtonText:Lang.get("messages.common.ok"),timer:1800}),setTimeout((function(){location.href=$("#cancelBtn").attr("href")}),2e3))}})}))})),$(document).on("click",".delete-btn",(function(e){var t=$(this).attr("data-id"),n='<div class="alert alert-warning swal__alert">\n<strong class="swal__text-warning">'+Lang.get("messages.common.are_you_sure_delete")+' "'+Lang.get("messages.ticket.ticket")+'" ?</strong><div class="swal__text-message">'+Lang.get("messages.ticket.by_deleting_this_ticket")+".</div></div>";swal({type:"input",inputPlaceholder:Lang.get("messages.ticket.type_delete_for_deletion")+" .",title:deleteHeading+" !",text:n,html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#5cb85c",cancelButtonColor:"#d33",cancelButtonText:Lang.get("messages.common.no"),confirmButtonText:Lang.get("messages.common.yes"),imageUrl:baseUrl+"assets/images/warning.png"},(function(e){return!1!==e&&(""==e||"delete"!=e.toLowerCase()?(swal.showInputError(Lang.get("messages.ticket.type_delete_for_deletion")+" ."),$(".sa-input-error").css("top","23px!important"),$(document).find(".sweet-alert.show-input :input").val(""),!1):void("delete"===e.toLowerCase()&&$.ajax({type:"DELETE",url:ticketDeleteUrl,data:{id:t},success:function(e){e.success&&(swal({title:Lang.get("messages.common.deleted")+" !",text:Lang.get("messages.ticket.ticket")+" "+Lang.get("messages.common.has_been_deleted")+".",type:"success",confirmButtonColor:o,confirmButtonText:Lang.get("messages.common.ok"),timer:2e3}),setTimeout((function(){location.href=$("#cancelBtn").attr("href")}),2e3))}})))}))}))})();