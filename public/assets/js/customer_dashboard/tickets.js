(()=>{"use strict";var e="",t="",a="",n=[];if(Dropzone.autoDiscover=!1,$("#addAttachmentDropzone").length)new Dropzone("#addAttachmentDropzone",{thumbnailWidth:125,acceptedFiles:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt,.ppt,.pptx,.sql,.json",timeout:5e4,autoProcessQueue:!1,parallelUploads:50,addRemoveLinks:!0,dictRemoveFile:'<i class="fa fa-trash-o text-danger" title="Remove"></i>',uploadMultiple:!0,init:function(){e=this;var t=document.querySelector("#save-file"),n=document.querySelector("#cancel-upload-file");function i(e,t,a){var n=e.name.split(".").pop();["pdf"].includes(n)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/pdf_icon.png"):["doc","docx"].includes(n)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/doc_icon.png"):["xls","xlsx","csv"].includes(n)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/xls_icon.png"):["text","txt"].includes(n)&&$(e.previewElement).find(".dz-image img").attr("src","/assets/img/txt_icon.png"),$(".dz-image").last().find("img").attr({width:"100%",height:"100%"})}t.addEventListener("click",(function(){$("#addAttachment").modal("toggle")})),n.addEventListener("click",(function(){e.removeAllFiles(!0),$("#attachment-counter").html(e.files.length),$("#addAttachment").modal("toggle")})),this.on("addedfile",(function(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t.size>10485760)return this.removeFile(t),displayToastr(Lang.get("messages.error_message.error"),"error",Lang.get("messages.validation.file_size")),!1;$("#attachment-counter").html(e.files.length),$(".dz-progress").hide(),$(".dz-remove").html(""),$(".dz-remove").addClass("fas fa-trash text-danger mt-3"),$(".dz-remove").prop("title","Delete"),i(t,a,n)})),this.on("sending",(function(e,t,n){var i=$(a).serializeArray();$.each(i,(function(e,t){n.append(t.name,t.value)}))}))},complete:function(e){this.getQueuedFiles().length>0&&this.processQueue()},removedfile:function(e){var t,a=parseInt($("#attachment-counter").html());if(a>0)return $("#attachment-counter").html(a-1),null!=(t=e.previewElement)?t.parentNode.removeChild(e.previewElement):void 0},success:function(e,t){var a=t.data;$("#addAttachment").modal("hide"),window.location.replace(a.redirectUrl)},error:function(t,a,n){e.removeAllFiles(!0),$("#attachment-counter").html(e.files.length),processingBtn("#addTicketForm","#btnSave"),null!=a.message?displayToastr(Lang.get("messages.error_message.error"),"error",a.message):(null==n&&this.removeFile(t),displayToastr(Lang.get("messages.error_message.error"),"error",a))}});if($("#editAttachmentDropzone").length)new Dropzone("#editAttachmentDropzone",{thumbnailWidth:125,acceptedFiles:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt,.ppt,.pptx,.sql,.json",addRemoveLinks:!0,dictRemoveFile:'<i class="fa fa-trash-o text-danger" title="Remove"></i>',timeout:5e4,autoProcessQueue:!1,parallelUploads:50,uploadMultiple:!0,init:function(){t=this;var e=document.querySelector("#save-file"),i=document.querySelector("#cancel-upload-file");function s(){$.get(getAttachmentUrl,(function(e){$.each(e.data,(function(e,a){$("#attachment-counter").html(parseInt($("#attachment-counter").html())+1);var n={name:a.name,id:a.id};t.options.addedfile.call(t,n,n.id),t.options.thumbnail.call(t,n,a.url),t.emit("complete",n),t.emit("thumbnail",n,a.url,n.id),$(".dz-remove").eq(e).attr("data-file-id",a.id),$(".dz-remove").eq(e).attr("data-file-url",a.url),$(".dz-remove").html(""),$(".dz-progress").hide(),1==isCustomer&&a.user_id==loggedInUserId&&($(".dz-remove").eq(e).addClass("fas fa-trash text-danger mt-3"),$(".dz-remove").prop("title","Delete"))}))}))}function r(e,t,a){var n=e.name.split(".").pop();if(["pdf"].includes(n)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/pdf_icon.png"):["doc","docx"].includes(n)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/doc_icon.png"):["xls","xlsx","csv"].includes(n)?$(e.previewElement).find(".dz-image img").attr("src","/assets/img/xls_icon.png"):["text","txt"].includes(n)&&$(e.previewElement).find(".dz-image img").attr("src","/assets/img/txt_icon.png"),"undefined"===$(e.previewElement).find(".download-link").attr("href")&&$(e.previewElement).find(".download-link").hide(),$(e.previewElement).find(".download-link").length<1&&null!=a){var i=document.createElement("a");i.setAttribute("href",ticketIndexUrl+"/media/"+a),i.setAttribute("class","download-link"),i.innerHTML="<br>Download",e.previewElement.appendChild(i)}$(".dz-image").last().find("img").attr({width:"100%",height:"100%"})}e.addEventListener("click",(function(){$("#editAttachment").modal("toggle")})),i.addEventListener("click",(function(){$("#attachment-counter").html(0),t.removeAllFiles(!0),n=[],$("div.dz-preview").remove(),s(),$("#editAttachment").modal("toggle")})),s(),this.on("thumbnail",(function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;$(e.previewTemplate).find(".dz-details").css("display","none"),r(e,t,a);var n=e.name.split("."),i=n[0].replace(/\s/g,"").replace(/\(/g,"_").replace(/\)/g,""),s=e.name.split(".").pop(),o="",l=!0;$(e.previewElement).find(".download-link").on("click",(function(){l=!1})),$.inArray(s,["jpg","JPG","jpeg","png","PNG"])>-1&&(o='<a class="'+i+'" data-fancybox="gallery" href="'+t+'" data-toggle="lightbox" data-gallery="example-gallery"></a>',$(".previewEle").append(o)),e.previewElement.addEventListener("click",(function(){if(l){var a=e.previewElement.querySelector("[data-dz-name]").innerHTML,n=a.split(".").pop();if($.inArray(n,["jpg","JPG","jpeg","png","PNG"])>-1){var i=a.split(".")[0];$("."+i).trigger("click")}else window.open(t,"_blank")}l=!0}))})),this.on("addedfile",(function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if($(e.previewTemplate).find(".dz-remove").attr("data-file-id","00"),e.size>10485760)return this.removeFile(e),displayToastr(Lang.get("messages.error_message.error"),"error",Lang.get("messages.validation.file_size")),!1;$("#attachment-counter").html(parseInt($("#attachment-counter").html())+1),$(".dz-progress").hide(),$(e.previewTemplate).find(".dz-remove").html(""),$(e.previewTemplate).find(".dz-remove").addClass("fas fa-trash text-danger mt-3"),r(e,t,a)})),this.on("sending",(function(e,t,n){var i=$(a).serializeArray();$.each(i,(function(e,t){t.name.startsWith("_")||n.append(t.name,t.value)}))}))},complete:function(e){this.getQueuedFiles().length>0&&this.processQueue()},processing:function(){$(".dz-remove").html(""),$(".dz-remove").addClass("fas fa-trash mt-3 text-danger"),$(".dz-remove").prop("title","Delete"),$(".dz-details").hide()},removedfile:function(e){var t,a=e.previewElement.querySelector("[data-file-id]").getAttribute("data-file-id");return"00"!=a?(function(e,t){swal({title:Lang.get("messages.swal_message.delete"),text:Lang.get("messages.swal_message.file_delete"),type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#5cb85c",cancelButtonColor:"#d33",cancelButtonText:Lang.get("messages.common.no"),confirmButtonText:Lang.get("messages.common.yes")},(function(){var a;return n.push(parseInt(t)),i("#editAttachmentDropzone"),swal({title:Lang.get("messages.swal_message.delete"),text:Lang.get("messages.swal_message.file_delete"),type:"success",confirmButtonColor:"#6777ef",confirmButtonText:Lang.get("messages.common.ok"),timer:1e3}),null!=(a=e.previewElement)?a.parentNode.removeChild(e.previewElement):void 0}))}(e,a),$("#attachment-counter").html(parseInt($("#attachment-counter").html())-1),!0):($("#attachment-counter").html(parseInt($("#attachment-counter").html())-1),null!=(t=e.previewElement)?t.parentNode.removeChild(e.previewElement):void 0)},success:function(e,t){var a=t.data;$("#editAttachment").modal("hide"),window.location.replace(a.redirectUrl)},error:function(e,a,n){if($("#attachment-counter").html(0),t.removeAllFiles(!0),processingBtn("#editTicketForm","#btnSave"),null==a.message)return null==n&&this.removeFile(e),i("#editAttachmentDropzone"),displayToastr(Lang.get("messages.error_message.error"),"error",a),!1;displayToastr(Lang.get("messages.error_message.error"),"error",a.message),i("#editAttachmentDropzone")}});function i(e){$(".dz-preview").length>=1?$(e).find(".dz-message").css({display:"none"}):$(e).find(".dz-message").css({display:"block"})}$(document).ready((function(){$(document).on("click","#attachmentButton",(function(){$("#addAttachment").appendTo("body").modal("show")})),$(document).on("click","#editAttachmentButton",(function(){$("#editAttachment").appendTo("body").modal("show")})),$("#categoryId").select2({width:"100%"}),$("#details").summernote({placeholder:Lang.get("messages.ticket.add_ticket_description"),height:"200px",toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["para",["paragraph"]]],disableResizeEditor:!0}),$(document).on("submit","#editTicketForm",(function(e){e.preventDefault(),$("input:hidden[name=deletedMediaId]").val(n),a="#editTicketForm";var i=$("#btnSave");i.button("loading");var s=$("<div />").html($("#details").summernote("code")),r=isOnlyContainWhiteSpace(s.text());return $("#details").summernote("isEmpty")?($("#details").val(""),displayErrorMessage(Lang.get("messages.common.description")+" "+Lang.get("messages.validation.required_field")),i.button("reset"),!1):r?(displayErrorMessage(Lang.get("messages.common.description")+" "+Lang.get("messages.validation.white_space")),i.button("reset"),!1):(0==$(".dz-preview").length||0==t.getQueuedFiles().length?$("#editTicketForm")[0].submit():t.processQueue(),!0)})),$(document).on("submit","#addTicketForm",(function(t){t.preventDefault(),a="#addTicketForm";var n=$("#btnSave");n.button("loading");var i=$("<div />").html($("#details").summernote("code")),s=isOnlyContainWhiteSpace(i.text());return""==$("#title").val()?(displayErrorMessage(Lang.get("messages.faq.title")+" "+Lang.get("messages.validation.required_field")),n.button("reset"),!1):isOnlyContainWhiteSpace($("#title").val())?(displayErrorMessage(Lang.get("messages.faq.title "+Lang.get("messages.validation.white_space"))),n.button("reset"),!1):$("#details").summernote("isEmpty")?($("#details").val(""),displayErrorMessage(Lang.get("messages.common.description")+" "+Lang.get("messages.validation.required_field")),n.button("reset"),!1):s?(displayErrorMessage(Lang.get("messages.common.description")+" "+Lang.get("messages.validation.white_space")),n.button("reset"),!1):(0==$(".dz-preview").length?$("#addTicketForm")[0].submit():e.processQueue(),!0)}))}))})();